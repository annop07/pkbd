<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéÇ Happy Birthday üéÇ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Kanit", sans-serif;
        background: #000000;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      body.rome4-bg {
        animation: fadeToRome4 3s ease forwards;
      }

      @keyframes fadeToRome4 {
        0% {
          background: #000000;
        }
        100% {
          background: url("photo/rome4.jpg") center/cover no-repeat;
        }
      }

      .container {
        text-align: center;
        position: relative;
      }

      .gift-box {
        cursor: pointer;
        transition: opacity 0.8s ease;
      }

      .gift-box.fade {
        opacity: 0;
      }

      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .popup-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .popup-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        padding: 0;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        max-width: 380px;
        width: 90%;
        transform: scale(0.8) translateY(50px);
        transition: all 0.4s ease;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .popup-overlay.show .popup-card {
        transform: scale(1) translateY(0);
      }

      .popup-header {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 20px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .popup-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
        overflow: hidden;
        padding: 3px;
      }

      .popup-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      .popup-title {
        color: white;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
        line-height: 1.2;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .popup-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        line-height: 1.2;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }

      .popup-body {
        display: flex;
        flex-direction: column;
      }

      /* ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏∏‡∏î */
      #popupMessage {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0; /* ‡∏Å‡∏±‡∏ô flex overflow */
      }

      .message-line {
        opacity: 1;
        margin-bottom: 8px;
        min-height: 1.8em;
      }

      .typewriter-cursor {
        display: inline-block;
        width: 2px;
        height: 1em;
        background: white;
        animation: blink 1s infinite;
        margin-left: 2px;
      }

      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }

      .popup-close {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-family: "Kanit", sans-serif;
        transition: all 0.3s ease;
      }

      /* ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î popup ‡∏à‡∏±‡∏î‡πÅ‡∏ô‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≠ */
      .popup-card,
      .popup-content {
        display: flex;
        flex-direction: column;
        max-height: min(86vh, 640px);
      }

      /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß */
      #popupMessage {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô */
      #popupMessage .msg-scroll {
        flex: 1;
        min-height: 0;
        overflow: auto;
        max-height: 56vh;
      }

      /* ‡πÑ‡∏•‡πà‡∏™‡∏µ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ (gradient mask) */
      #popupMessage .msg-scroll::before,
      #popupMessage .msg-scroll::after {
        content: "";
        position: sticky;
        left: 0;
        right: 0;
        height: 16px;
        pointer-events: none;
        z-index: 1;
      }
      #popupMessage .msg-scroll::before {
        top: 0;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0)
        );
      }
      #popupMessage .msg-scroll::after {
        bottom: 0;
        background: linear-gradient(
          to top,
          rgba(255, 255, 255, 0.9),
          rgba(255, 255, 255, 0)
        );
      }

      /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      #popupMessage .message-line {
        color: #fff;
        font-size: 15px;
        line-height: 1.5;
        margin: 2px 0;
        word-break: break-word;
      }

      /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠/‡∏¢‡πà‡∏≠ */
      #popupMessage .msg-toggle {
        align-self: center;
        margin-top: 6px;
        padding: 8px 14px;
        border-radius: 999px;
        border: 0;
        background: #111;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
      }

      /* ‡πÇ‡∏´‡∏°‡∏î‡∏Ç‡∏¢‡∏≤‡∏¢ (‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î) */
      .popup-card.expand,
      .popup-content.expand {
        max-height: 92vh;
      }
      #popupMessage.expand .msg-scroll {
        max-height: 78vh;
      }
      #popupMessage.expanded .msg-scroll {
        max-height: 64vh;
      }

      /* (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ .popup-card ‡∏´‡∏£‡∏∑‡∏≠ .popup-content */
      .popup-card.expanded,
      .popup-content.expanded {
        max-height: 92vh;
      }

      /* ‡∏™‡∏Å‡∏£‡∏≠‡∏•‡∏ö‡∏≤‡∏£‡πå (WebKit) */
      #popupMessage .msg-scroll::-webkit-scrollbar {
        width: 6px;
      }
      #popupMessage .msg-scroll::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.25);
        border-radius: 6px;
      }

      /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å */
      @media (max-width: 380px) {
        #popupMessage .message-line {
          font-size: 14px;
        }
        #popupMessage .msg-scroll {
          max-height: 60vh;
        }
      }

      .popup-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .envelope-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .envelope-popup.show {
        opacity: 1;
        visibility: visible;
      }

      .envelope-card {
        background: white;
        border-radius: 20px;
        padding: 30px 25px;
        text-align: center;
        max-width: 320px;
        width: 90%;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
        transform: scale(0.8) translateY(50px);
        transition: all 0.4s ease;
        font-family: "Kanit", sans-serif;
      }

      .envelope-popup.show .envelope-card {
        transform: scale(1) translateY(0);
      }

      .envelope-icon {
        margin-bottom: 15px;
      }
      .envelope-icon img {
        width: 80px;
        height: 80px;
        object-fit: contain;
      }

      .envelope-question {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .envelope-subtext {
        font-size: 14px;
        color: #666;
        margin-bottom: 25px;
      }

      .envelope-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .envelope-btn {
        flex: 1;
        padding: 12px 0;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: 0.3s;
      }

      .envelope-btn.yes {
        background: #28a745;
        color: white;
      }
      .envelope-btn.no {
        background: #dc3545;
        color: white;
      }
      .envelope-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }

      /* ====== Letter overlay (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß) ====== */
      .letter-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2500;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        perspective: 1200px;
      }
      .letter-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      /* ====== Envelope (‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏ï‡πà‡∏á) ====== */
      #letterEnvelope {
        position: relative;
        width: min(90vw, 360px);
        height: min(60vw, 240px);
        margin: 0 auto;
        border-radius: 14px;
        background: linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transform-style: preserve-3d;
        z-index: 14; /* ‡πÉ‡∏ï‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
      }
      /* liner / front / flap / stamp ... (‡∏Ñ‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ) */
      #letterEnvelope .env-liner {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at 20% 15%,
            rgba(255, 255, 255, 0.9),
            rgba(255, 255, 255, 0) 40%
          ),
          repeating-linear-gradient(135deg, #fdf3f6 0 12px, #f5f9ff 12px 24px);
        border-radius: 14px;
        transform: translateZ(-1px);
        z-index: 1;
      }
      #letterEnvelope .env-front {
        position: absolute;
        inset: 45% 0 0 0;
        background: linear-gradient(180deg, #fff 0%, #f5f5f5 100%);
        border-bottom-left-radius: 14px;
        border-bottom-right-radius: 14px;
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.04);
        z-index: 3;
      }
      #letterEnvelope .env-front::before,
      #letterEnvelope .env-front::after {
        content: "";
        position: absolute;
        bottom: 0;
        width: 58%;
        height: 72%;
        background: linear-gradient(180deg, #fff 0%, #f7f7f7 100%);
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.04);
      }
      #letterEnvelope .env-front::before {
        left: -6%;
        clip-path: polygon(0 100%, 100% 100%, 100% 0);
        border-bottom-left-radius: 14px;
      }
      #letterEnvelope .env-front::after {
        right: -6%;
        clip-path: polygon(0 100%, 100% 100%, 0 0);
        border-bottom-right-radius: 14px;
      }

      #letterEnvelope .env-flap {
        position: absolute;
        inset: 0 0 52% 0;
        background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%);
        clip-path: polygon(0 0, 100% 0, 100% 70%, 50% 100%, 0 70%);
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.05),
          0 2px 8px rgba(0, 0, 0, 0.08);
        transform-origin: 50% 0%;
        transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1),
          box-shadow 0.3s ease;
        border-top-left-radius: 14px;
        border-top-right-radius: 14px;
        z-index: 5;
      }
      #letterEnvelope .env-stamp {
        position: absolute;
        right: 16px;
        top: 22%;
        translate: 0 -50%;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ff7aa8, #ff4d84);
        box-shadow: 0 4px 10px rgba(255, 77, 132, 0.35),
          inset 0 0 0 2px rgba(255, 255, 255, 0.6);
        color: #fff;
        font-weight: 700;
        line-height: 38px;
        text-align: center;
        font-size: 18px;
        user-select: none;
        z-index: 5;
      }
      #letterEnvelope::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 14px;
        padding: 8px;
        -webkit-mask: linear-gradient(#000 0 0) content-box,
          linear-gradient(#000 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        background: repeating-linear-gradient(
          45deg,
          #ff5e7e 0 12px,
          #ff5e7e 12px 16px,
          #4a90ff 16px 28px,
          #4a90ff 28px 32px
        );
        pointer-events: none;
        opacity: 0.4;
      }
      #letterEnvelope.open .env-flap {
        transform: rotateX(160deg);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
      }
      #letterEnvelope:hover {
        transform: translateY(-2px);
        transition: transform 0.25s ease;
      }

      @media (max-width: 420px) {
        #letterEnvelope {
          border-radius: 12px;
        }
        #letterEnvelope .env-stamp {
          width: 34px;
          height: 34px;
          line-height: 34px;
          font-size: 16px;
        }
      }

      /* ====== Letter paper (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å @media ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏≠) ====== */
      #letterPaper.letter-paper {
        position: absolute;
        left: 50%;
        bottom: 8%;
        transform: translate(-50%, 75%); /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ã‡∏≠‡∏á */
        width: calc(100% - 28px);
        max-height: 70vh; /* ‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏ö‡∏≤‡∏¢ */
        background: #fffdf8;
        background-image: linear-gradient(
            180deg,
            rgba(0, 0, 0, 0.03),
            rgba(0, 0, 0, 0) 48px
          ),
          repeating-linear-gradient(
            180deg,
            transparent 0 44px,
            rgba(0, 0, 0, 0.045) 44px 45px
          );
        border-radius: 14px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transition: transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1),
          box-shadow 0.3s ease;
        will-change: transform;
        z-index: 2; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ã‡∏≠‡∏á */
      }
      #letterPaper .paper-notch {
        width: 52px;
        height: 6px;
        background: rgba(0, 0, 0, 0.18);
        border-radius: 999px;
        margin: 10px auto 6px;
        opacity: 0.55;
      }
      #letterPaper .paper-content {
        padding: 12px 16px 18px;
        max-height: calc(70vh - 24px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        color: #222;
        font-size: 15.5px;
        line-height: 1.6;
      }

      /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ç‡∏∂‡πâ‡∏ô */
      #letterPaper.up {
        transform: translate(-50%, -6%); /* ‡πÇ‡∏ú‡∏•‡πà‡∏û‡πâ‡∏ô‡∏õ‡∏≤‡∏Å‡∏ã‡∏≠‡∏á */
        box-shadow: 0 18px 36px rgba(0, 0, 0, 0.24),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        z-index: 4;
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å */
      @media (max-width: 380px) {
        #letterPaper.letter-paper {
          width: 92vw;
        }
        #letterPaper .paper-content {
          font-size: 15px;
        }
      }
      /* ==== Fireworks overlay ==== */
      .fireworks {
        position: fixed;
        inset: 0;
        width: 100vw;
        height: 100vh;
        z-index: 3000; /* ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
        pointer-events: none; /* ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å */
        display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô */
      }
      .fireworks.show {
        display: block;
      }

      /* ==== Success Overlay (‡∏´‡∏•‡∏±‡∏á‡∏û‡∏•‡∏∏) ==== */
      .success-overlay {
        position: fixed;
        inset: 0;
        z-index: 3200;
        display: none;
        align-items: center;
        justify-content: center;
        background: radial-gradient(
          ellipse at center,
          rgba(0, 0, 0, 0.55),
          rgba(0, 0, 0, 0.75)
        );
        backdrop-filter: blur(2px);
      }

      .success-overlay.show {
        display: flex;
      }

      .success-card {
        width: min(90vw, 360px);
        border-radius: 16px;
        padding: 24px 18px;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.25);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
        color: #fff;
        text-align: center;
      }

      .success-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 6px;
      }

      .success-subtitle {
        font-size: 15px;
        opacity: 0.9;
        margin-bottom: 16px;
      }

      .success-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      .success-btn {
        appearance: none;
        border: 0;
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 700;
        cursor: pointer;
        color: #111;
        background: #fff;
      }

      .success-btn.ghost {
        background: transparent;
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.6);
      }
      /* ==== Fireworks Image ==== */
      .fireworks-image {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 3100; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ canvas ‡πÅ‡∏ï‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ success overlay */
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.8s ease;
      }

      .fireworks-image img {
        width: 180px;
        max-width: 60vw;
        height: auto;
      }

      /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå */
      .fireworks-image.show {
        opacity: 1;
      }
      /* ==== ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏Ñ‡πâ‡∏Å ==== */
      .fireworks-caption {
        margin-top: 10px;
        font-size: 18px;
        font-weight: 600;
        color: #fff;
        text-align: center;
        text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.8s ease, transform 0.8s ease;
      }

      .fireworks-image.show .fireworks-caption {
        opacity: 1;
        transform: translateY(0);
      }
      /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á üéÅ */
      /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ï‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á üéÅ ‡πÅ‡∏ö‡∏ö‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏• */
      .click-text {
        color: #ff9fcf; /* ‡∏ä‡∏°‡∏û‡∏π‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏ô‡∏∏‡πà‡∏° ‡πÜ */
        font-size: 20px;
        font-weight: 600;
        margin-top: 10px;
        margin-bottom: 16px;
        letter-spacing: 0.5px;
        text-align: center;
      }
      /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ß‡∏≤‡∏á absolute child ‡πÑ‡∏î‡πâ */
      .gift-box {
        position: relative;
        display: inline-block;
      }

      /* ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î (‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á‡πÅ‡∏£‡∏á) */
      .gift-box:active {
        transform: scale(0.98);
      }

      /* ‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô ‚Äò‡∏õ‡∏∏‡πâ‡∏á‚Äô */
      .gift-pop {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 0;
        height: 0;
        border-radius: 9999px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.65),
          rgba(255, 192, 203, 0.35) 60%,
          rgba(255, 192, 203, 0) 75%
        );
        transform: translate(-50%, -50%);
        animation: pop-ring 0.6s ease-out forwards;
        pointer-events: none;
        will-change: transform, opacity, width, height;
      }
      @keyframes pop-ring {
        from {
          width: 0;
          height: 0;
          opacity: 0.9;
        }
        to {
          width: 220px;
          height: 220px;
          opacity: 0;
        }
      }

      /* ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏¥ (‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•) */
      .confetti {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 8px;
        height: 12px;
        border-radius: 2px;
        background: currentColor; /* ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å style.color */
        transform: translate(-50%, -50%) rotate(0deg);
        animation: confetti-fall 700ms ease-out forwards;
        pointer-events: none;
        will-change: transform, opacity;
      }
      @keyframes confetti-fall {
        0% {
          opacity: 1;
          transform: translate(-50%, -50%) translate(0, 0) rotate(0deg);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) translate(var(--dx), var(--dy))
            rotate(180deg);
        }
      }
      .sound-toggle {
        position: fixed;
        right: 14px;
        top: 14px;
        z-index: 2600;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #fff;
        border-radius: 999px;
        padding: 8px 10px;
        font-size: 16px;
        backdrop-filter: blur(8px);
        cursor: pointer;
      }
      .sound-toggle[aria-pressed="true"] {
        /* playing */
        background: rgba(255, 255, 255, 0.2);
      }

      /* hint ‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
      .sound-hint {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        z-index: 2600;
        color: #fff;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="gift-box" id="giftBox" style="font-size: 200px">üéÅ</div>

      <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Click üéÅ Please !!! -->
      <p class="click-text">Click üéÅ Please !!!</p>

      <div style="color: white; font-size: 24px; margin-bottom: 20px">
        Happy Birthday to PK ‚óï‚Äø‚óïÔΩ°
      </div>

      <!-- Popup Birthday Message -->
      <div class="popup-overlay" id="popupOverlay">
        <div class="popup-card">
          <div class="popup-header">
            <div class="popup-avatar">
              <img src="photo/Cats Chibi GIF.gif" alt="Cats Chibi" />
            </div>
            <div class="popup-title">phognkiny üå∏</div>
            <div class="popup-subtitle">Ÿ©(‚óï‚Äø‚óï)€∂ üíê ‚ù§</div>
          </div>
          <div class="popup-body">
            <div class="popup-message" id="popupMessage">
              <div class="msg-scroll">
                <!-- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div
                  class="message-line"
                  data-text="happy birthday, you ‚ô°"
                ></div>
                <div
                  class="message-line"
                  data-text="i‚Äôm so thankful i got to meet you"
                ></div>
                <div
                  class="message-line"
                  data-text="sometimes i still can‚Äôt believe i have the chance to know someone like you"
                ></div>
                <div
                  class="message-line"
                  data-text="you‚Äôve been such a good part of my life, and every day feels a little brighter because you‚Äôre there"
                ></div>
                <div
                  class="message-line"
                  data-text="you make things lighter and happier just by being around"
                ></div>

                <div class="message-line" data-text=""></div>
                <!-- ‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î -->

                <div
                  class="message-line"
                  data-text="i hope today makes you feel all the love and happiness you truly deserve"
                ></div>
                <div
                  class="message-line"
                  data-text="you‚Äôre such a kind and genuine person, and you always give so much to the people you care about"
                ></div>
                <div
                  class="message-line"
                  data-text="now it‚Äôs your turn to receive that same love back"
                ></div>
                <div
                  class="message-line"
                  data-text="you deserve to rest, to smile, and to be surrounded by good energy‚Äîtoday and always"
                ></div>

                <div class="message-line" data-text=""></div>

                <div
                  class="message-line"
                  data-text="i want you to know i‚Äôm always proud of you"
                ></div>
                <div
                  class="message-line"
                  data-text="in everything you do, even when things get tough, i‚Äôll always be cheering you on"
                ></div>
                <div
                  class="message-line"
                  data-text="you‚Äôve come so far, and i‚Äôll always be here to celebrate your wins and support you on your bad days"
                ></div>
                <div
                  class="message-line"
                  data-text="you‚Äôll never have to go through anything alone as long as you let me be there"
                ></div>

                <div class="message-line" data-text=""></div>

                <div
                  class="message-line"
                  data-text="so happy birthday again! enjoy your day and let yourself feel how special you really are"
                ></div>
                <div
                  class="message-line"
                  data-text="i appreciate you so much, and i‚Äôll always be here rooting for you :3"
                ></div>
                <!-- ... (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ... -->
                <div
                  class="message-line"
                  data-text="and‚Ä¶ i hope every year on your birthday, i‚Äôll still get to be here with you too"
                ></div>
              </div>
            </div>

            <button class="popup-close" onclick="showEnvelopePopup()">
              ‡πÄ‡∏õ‡∏¥‡∏î üíå
            </button>
          </div>
        </div>
      </div>

      <!-- Envelope Popup -->
      <div class="envelope-popup" id="envelopePopup">
        <div class="envelope-card">
          <div class="envelope-icon">
            <img src="./photo/No.gif" alt="cute" />
          </div>
          <div class="envelope-question">Do you want a gift? ü•∫‚ù§Ô∏è</div>
          <p class="envelope-subtext">Come on, answer</p>
          <div class="envelope-buttons">
            <button
              class="envelope-btn yes"
              onclick="handleEnvelopeChoice('yes')"
            >
              Yes
            </button>
            <button
              class="envelope-btn no"
              onclick="handleEnvelopeChoice('no')"
            >
              No
            </button>
          </div>
        </div>
      </div>

      <!-- Blessing Popup (UPDATED) -->
      <div class="envelope-popup" id="blessingPopup">
        <div class="envelope-card">
          <div class="envelope-icon">
            <img src="photo/tkthao219-bubududu.gif" alt="cute" />
          </div>
          <div class="envelope-question">
            Awh.. Let's try again? PLEASEE .‚óï‚Äø‚óï.
          </div>
          <div class="envelope-buttons">
            <button class="envelope-btn yes" onclick="tryAgain()">
              Again.. ?
            </button>
          </div>
        </div>
      </div>

      <!-- Success Overlay -->
      <div id="successOverlay" class="success-overlay">
        <div class="success-card">
          <div class="success-title">Happy Birthday again dekk</div>
          <div class="success-subtitle">thank you ‚ô°</div>
          <div class="success-actions">
            <button type="button" class="success-btn" id="replayFireworksBtn">
              replay
            </button>
            <button
              type="button"
              class="success-btn ghost"
              id="closeSuccessBtn"
            >
              close
            </button>
          </div>
        </div>
      </div>

      <!-- Letter Overlay -->
      <div id="letterOverlay" class="letter-overlay">
        <div id="letterEnvelope">
          <div class="env-liner"></div>

          <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ã‡∏≠‡∏á -->
          <div
            class="letter-paper"
            id="letterPaper"
            aria-label="Letter content"
          >
            <div class="paper-notch"></div>
            <div class="paper-content">
              <p id="letterText"></p>
            </div>
          </div>

          <div class="env-front"></div>
          <div class="env-flap"></div>
          <div class="env-stamp">‚ô°</div>
        </div>
      </div>
    </div>

    <!-- BGM -->
    <audio id="bgm" src="./audio/love_wave.mp3" preload="auto" loop></audio>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏• -->
    <!-- <button
      id="soundToggle"
      class="sound-toggle"
      aria-pressed="false"
      title="Sound"
    >
      üîà
    </button> -->

    <!-- ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡πÄ‡∏ú‡∏∑‡πà‡∏≠ autoplay fail) -->
    <!-- <div id="soundHint" class="sound-hint" hidden>
      Tap anywhere to enable sound
    </div> -->

    <canvas id="fireworksCanvas" class="fireworks"></canvas>
    <div id="fireworksImageWrapper" class="fireworks-image">
      <img
        id="fireworksImage"
        src="./photo/cake-birthday-cake.gif"
        alt="Celebration"
      />
      <p class="fireworks-caption">Blow the cake!</p>
    </div>

    <script>
      const giftBox = document.getElementById("giftBox");
      const popupOverlay = document.getElementById("popupOverlay");
      let isClicked = false;

      const letterOverlay = document.getElementById("letterOverlay");
      const letterEnvelope = document.getElementById("letterEnvelope");
      const letterPaper = document.getElementById("letterPaper");

      function setLetterMessage(message) {
        const p = document.getElementById("letterText");
        if (!p) return;
        // ‡πÅ‡∏õ‡∏•‡∏á \n ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô HTML
        p.innerHTML = String(message || "")
          .trim()
          .replace(/\n/g, "<br>");
      }

      function revealPaper() {
        letterPaper.classList.add("up");
        const content = letterPaper.querySelector(".paper-content");
        if (content && content.focus) content.focus();
      }

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ô openLetter() ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° .open ‡πÉ‡∏´‡πâ‡∏ã‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
      function openLetter() {
        letterOverlay.classList.add("show");
        setTimeout(() => {
          letterEnvelope.classList.add("open"); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ã‡∏≠‡∏á
          // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ ‚Äú‡πÅ‡∏ï‡∏∞‡∏ã‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‚Äù
          letterEnvelope.addEventListener("click", revealPaper, { once: true });

          // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡πÑ‡∏ó‡∏õ‡πå‡∏ä‡πâ‡∏≤‡πÜ)
          setLetterMessage(
            `happy birthday, you ‚ô°

i‚Äôm so thankful i got to meet you. sometimes i still can‚Äôt believe i have the chance to know someone like you. you‚Äôve been such a good part of my life, and every day feels a little brighter because you‚Äôre there. you make things lighter and happier just by being around.

i hope today makes you feel all the love and happiness you truly deserve. you‚Äôre such a kind and genuine person, and you always give so much to the people you care about. now it‚Äôs your turn to receive that same love back. you deserve to rest, to smile, and to be surrounded by good energy‚Äîtoday and always.

i want you to know i‚Äôm always proud of you. in everything you do, even when things get tough, i‚Äôll always be cheering you on. you‚Äôve come so far, and i‚Äôll always be here to celebrate your wins and support you on your bad days. you‚Äôll never have to go through anything alone as long as you let me be there.

so happy birthday again! enjoy your day and let yourself feel how special you really are. i appreciate you so much, and i‚Äôll always be here rooting for you :3
and‚Ä¶ i hope every year on your birthday, i‚Äôll still get to be here with you too.` // ‚Üê ‡∏à‡∏±‡∏î‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ \n
          );
        }, 300);
      }

      // ‡∏õ‡∏¥‡∏î overlay ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
      function closeLetterOverlay() {
        letterOverlay.classList.remove("show");
        letterEnvelope.classList.remove("open");
        letterPaper.classList.remove("up");
      }

      // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î (‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î)
      letterOverlay.addEventListener("click", (e) => {
        if (e.target === letterOverlay) closeLetterOverlay(); // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ñ‡∏∂‡∏á‡∏õ‡∏¥‡∏î
      });
      letterEnvelope.addEventListener("click", (e) => e.stopPropagation());
      letterPaper.addEventListener("click", (e) => e.stopPropagation());

      giftBox.addEventListener("click", function () {
        // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏à‡∏¥‡πâ‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
        burstAt(giftBox, 22);

        if (!isClicked) {
          giftBox.classList.add("fade");
          document.body.classList.add("rome4-bg");
          setTimeout(() => {
            popupOverlay.classList.add("show");
            startTypewriterEffect();
          }, 1000);
          isClicked = true;
        }
      });

      function startTypewriterEffect() {
        const lines = document.querySelectorAll(".message-line");

        lines.forEach((line) => {
          line.textContent = line.getAttribute("data-text");
        });
      }

      function showEnvelopePopup() {
        document.getElementById("envelopePopup").classList.add("show");
      }

      function handleEnvelopeChoice(choice) {
        const envelopePopup = document.getElementById("envelopePopup");
        envelopePopup.classList.remove("show");

        if (choice === "yes") {
          setTimeout(async () => {
            closePopup();
            closeLetterOverlay();
            setLetterMessage("");
            document.getElementById("letterOverlay")?.remove();

            // ==== ‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô‡∏û‡∏•‡∏∏ ====
            const imgWrapper = document.getElementById("fireworksImageWrapper");
            imgWrapper.classList.add("show");

            // ‡πÄ‡∏•‡πà‡∏ô‡∏û‡∏•‡∏∏ 7 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            await startFireworks(7000);

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏•‡∏∏‡∏à‡∏ö
            imgWrapper.classList.remove("show");

            // ‡πÅ‡∏™‡∏î‡∏á success overlay
            document.getElementById("successOverlay")?.classList.add("show");
          }, 400);
        } else {
          setTimeout(() => {
            document.getElementById("blessingPopup").classList.add("show");
          }, 500);
        }
      }

      function closePopup() {
        popupOverlay.classList.remove("show");
      }

      function closeBlessing() {
        document.getElementById("blessingPopup").classList.remove("show");
      }

      // NEW FUNCTION: ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
      function tryAgain() {
        // ‡∏õ‡∏¥‡∏î blessing popup
        document.getElementById("blessingPopup").classList.remove("show");

        // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î envelope popup ‡πÉ‡∏´‡∏°‡πà
        setTimeout(() => {
          document.getElementById("envelopePopup").classList.add("show");
        }, 300);
      }

      function typeLetterMessage(message) {
        const target = document.getElementById("letterText");
        target.textContent = "";
        let index = 0;
        function type() {
          if (index < message.length) {
            target.textContent += message[index];
            index++;
            setTimeout(type, 80);
          }
        }
        setTimeout(type, 900);
      }

      (function setupFireworks() {
        const canvas = document.getElementById("fireworksCanvas");
        if (!canvas) return;
        const ctx = canvas.getContext("2d");

        let W,
          H,
          rafId = null;
        let rockets = [];
        let particles = [];
        let running = false;

        function resize() {
          W = canvas.width = window.innerWidth;
          H = canvas.height = window.innerHeight;
        }
        window.addEventListener("resize", resize);
        resize();

        class Rocket {
          constructor() {
            this.x = Math.random() * W;
            this.y = H + 10;
            this.vx = (Math.random() - 0.5) * 1.2;
            this.vy = -(7 + Math.random() * 3);
            this.color = `hsl(${Math.floor(Math.random() * 360)},100%,60%)`;
            this.exploded = false;
            this.targetY = 100 + Math.random() * (H * 0.5);
          }
          update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += 0.02;
            if (this.y <= this.targetY || this.vy >= -1) {
              this.explode();
            }
          }
          explode() {
            if (this.exploded) return;
            this.exploded = true;
            const count = 60 + Math.floor(Math.random() * 40);
            for (let i = 0; i < count; i++) {
              const angle = (Math.PI * 2 * i) / count;
              const speed = 2 + Math.random() * 3.5;
              particles.push(
                new Particle(
                  this.x,
                  this.y,
                  Math.cos(angle) * speed,
                  Math.sin(angle) * speed,
                  this.color
                )
              );
            }
          }
          draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
          }
        }

        class Particle {
          constructor(x, y, vx, vy, color) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.life = 1;
            this.decay = 0.012 + Math.random() * 0.02;
            this.color = color;
            this.size = 2 + Math.random() * 2;
            this.gravity = 0.03 + Math.random() * 0.03;
          }
          update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += this.gravity;
            this.vx *= 0.985;
            this.vy *= 0.985;
            this.life -= this.decay;
          }
          draw() {
            if (this.life <= 0) return;
            ctx.globalAlpha = Math.max(this.life, 0);
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.globalAlpha = 1;
          }
        }

        function spawnRockets(n = 3) {
          for (let i = 0; i < n; i++) rockets.push(new Rocket());
        }

        function loop() {
          ctx.globalCompositeOperation = "source-over";
          ctx.fillStyle = "rgba(0,0,0,0.2)";
          ctx.fillRect(0, 0, W, H);
          ctx.globalCompositeOperation = "lighter";

          for (let i = rockets.length - 1; i >= 0; i--) {
            const r = rockets[i];
            if (!r.exploded) r.update();
            r.draw();
            if (r.exploded) rockets.splice(i, 1);
          }

          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(i, 1);
          }

          if (Math.random() < 0.04) spawnRockets(1);
          rafId = requestAnimationFrame(loop);
        }

        function start(durationMs = 6000) {
          return new Promise((resolve) => {
            if (running) {
              resolve();
              return;
            }
            running = true;
            canvas.classList.add("show");
            spawnRockets(4);
            loop();
            setTimeout(() => {
              stop();
              resolve();
            }, durationMs);
          });
        }

        function stop() {
          if (!running) return;
          running = false;
          cancelAnimationFrame(rafId);
          rafId = null;
          rockets = [];
          particles = [];
          ctx.clearRect(0, 0, W, H);
          canvas.classList.remove("show");
        }

        window.startFireworks = start;
        window.stopFireworks = stop;
      })();

      // Success overlay buttons
      (function setupSuccessOverlayControls() {
        const overlay = document.getElementById("successOverlay");
        const replayBtn = document.getElementById("replayFireworksBtn");
        const closeBtn = document.getElementById("closeSuccessBtn");
        if (replayBtn) {
          replayBtn.addEventListener("click", async () => {
            overlay.classList.remove("show");
            await startFireworks(6000);
            overlay.classList.add("show");
          });
        }
        if (closeBtn) {
          closeBtn.addEventListener("click", () => {
            overlay.classList.remove("show");
          });
        }
      })();

      // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠/‡∏¢‡πà‡∏≠: toggle ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
      (function setupExpandToggle() {
        const btn = document.getElementById("msgToggleBtn");
        const popupMessage = document.getElementById("popupMessage");
        if (!btn || !popupMessage) return;

        // ‡∏´‡∏≤ container ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        const card =
          popupMessage.closest(".popup-card") ||
          popupMessage.closest(".popup-content") ||
          document.querySelector(".popup-card") ||
          document.querySelector(".popup-content");

        // ‡∏´‡∏≤ scroller ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô fallback ‡πÑ‡∏î‡πâ)
        const scroller = popupMessage.querySelector(".msg-scroll");

        btn.addEventListener("click", () => {
          const expanded = btn.getAttribute("aria-expanded") === "true";
          const next = !expanded;

          // toggle class ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ control ‡πÄ‡∏≠‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
          popupMessage.classList.toggle("expand", next);
          if (card) card.classList.toggle("expand", next);

          // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ CSS class ‡∏Ñ‡∏£‡∏≠‡∏ö (fallback): ‡∏õ‡∏£‡∏±‡∏ö style ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
          if (scroller) {
            if (next) {
              scroller.style.maxHeight = "78vh";
            } else {
              scroller.style.maxHeight = ""; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å CSS ‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô 56vh)
            }
          }

          btn.setAttribute("aria-expanded", String(next));
          btn.textContent = next ? "‡∏¢‡πà‡∏≠" : "‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠";
        });
      })();

      // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏£‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç
      function burstAt(el, count = 20) {
        // ‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô ‚Äò‡∏õ‡∏∏‡πâ‡∏á‚Äô
        const ring = document.createElement("span");
        ring.className = "gift-pop";
        el.appendChild(ring);
        setTimeout(() => ring.remove(), 650);

        // ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏¥‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•
        const palette = ["#ff7eb9", "#ffd166", "#9be7ff", "#caffbf", "#bdb2ff"];
        for (let i = 0; i < count; i++) {
          const s = document.createElement("span");
          s.className = "confetti";

          // ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏£‡∏≠‡∏ö ‡πÜ ‡πÅ‡∏ö‡∏ö‡∏ß‡∏á‡∏Å‡∏•‡∏° + ‡∏™‡∏∏‡πà‡∏°‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢
          const angle = (Math.PI * 2 * i) / count + (Math.random() * 0.6 - 0.3);
          const dist = 60 + Math.random() * 60;
          const dx = Math.cos(angle) * dist;
          const dy = Math.sin(angle) * dist - 10;

          s.style.setProperty("--dx", dx + "px");
          s.style.setProperty("--dy", dy + "px");
          s.style.color = palette[i % palette.length];

          el.appendChild(s);
          setTimeout(() => s.remove(), 750);
        }
      }
      const bgm = document.getElementById("bgm");
      const soundBtn = document.getElementById("soundToggle");
      const soundHint = document.getElementById("soundHint");

      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ö‡∏≤‡πÜ (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)
      bgm.volume = 0.35;

      // 1) ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
      window.addEventListener("DOMContentLoaded", async () => {
        try {
          await bgm.play(); // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢
          soundBtn.setAttribute("aria-pressed", "true");
          soundBtn.textContent = "üîä";
        } catch (err) {
          // ‡πÇ‡∏î‡∏ô policy ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ ‚Üí ‡∏£‡∏≠ user gesture
          soundHint.hidden = false;
          soundBtn.setAttribute("aria-pressed", "false");
          soundBtn.textContent = "üîà";
        }
      });

      // 2) ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á üéÅ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      //    (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ giftBox ‡πÅ‡∏•‡∏∞ isClicked ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
      document.getElementById("giftBox")?.addEventListener(
        "click",
        async () => {
          if (bgm.paused) {
            try {
              await bgm.play();
              soundBtn.setAttribute("aria-pressed", "true");
              soundBtn.textContent = "üîä";
              soundHint.hidden = true;
            } catch (e) {}
          }
        },
        { once: false }
      );

      // 3) ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
      soundBtn.addEventListener("click", async () => {
        if (bgm.paused) {
          try {
            await bgm.play();
            soundBtn.setAttribute("aria-pressed", "true");
            soundBtn.textContent = "üîä";
            soundHint.hidden = true;
          } catch (e) {}
        } else {
          bgm.pause();
          soundBtn.setAttribute("aria-pressed", "false");
          soundBtn.textContent = "üîà";
        }
      });

      // 4) ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏ñ‡πâ‡∏≤ hint ‡πÇ‡∏ú‡∏•‡πà
      document.addEventListener(
        "pointerdown",
        async () => {
          if (!soundHint.hidden && bgm.paused) {
            try {
              await bgm.play();
              soundBtn.setAttribute("aria-pressed", "true");
              soundBtn.textContent = "üîä";
              soundHint.hidden = true;
            } catch (e) {}
          }
        },
        { once: true }
      );
    </script>
  </body>
</html>
