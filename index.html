<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéÇ Happy Birthday üéÇ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Kanit", sans-serif;
        background: #000000;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      body.rome4-bg {
        animation: fadeToRome4 3s ease forwards;
      }

      @keyframes fadeToRome4 {
        0% {
          background: #000000;
        }
        100% {
          background: url("photo/rome4.jpg") center/cover no-repeat;
        }
      }

      .container {
        text-align: center;
        position: relative;
      }

      .gift-box {
        cursor: pointer;
        transition: opacity 0.8s ease;
      }

      .gift-box.fade {
        opacity: 0;
      }

      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .popup-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .popup-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        padding: 0;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        max-width: 380px;
        width: 90%;
        transform: scale(0.8) translateY(50px);
        transition: all 0.4s ease;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .popup-overlay.show .popup-card {
        transform: scale(1) translateY(0);
      }

      .popup-header {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 20px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .popup-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
        overflow: hidden;
        padding: 3px;
      }

      .popup-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      .popup-title {
        color: white;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
        line-height: 1.2;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      .popup-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        line-height: 1.2;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }

      .popup-body {
        padding: 25px 20px;
        text-align: center;
        color: white;
      }

      .popup-message {
        font-size: 18px;
        line-height: 1.8;
        margin-bottom: 25px;
      }

      .message-line {
        opacity: 1;
        margin-bottom: 8px;
        min-height: 1.8em;
      }

      .typewriter-cursor {
        display: inline-block;
        width: 2px;
        height: 1em;
        background: white;
        animation: blink 1s infinite;
        margin-left: 2px;
      }

      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }

      .popup-close {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-family: "Kanit", sans-serif;
        transition: all 0.3s ease;
      }

      .popup-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .envelope-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .envelope-popup.show {
        opacity: 1;
        visibility: visible;
      }

      .envelope-card {
        background: white;
        border-radius: 20px;
        padding: 30px 25px;
        text-align: center;
        max-width: 320px;
        width: 90%;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
        transform: scale(0.8) translateY(50px);
        transition: all 0.4s ease;
        font-family: "Kanit", sans-serif;
      }

      .envelope-popup.show .envelope-card {
        transform: scale(1) translateY(0);
      }

      .envelope-icon {
        margin-bottom: 15px;
      }
      .envelope-icon img {
        width: 80px;
        height: 80px;
        object-fit: contain;
      }

      .envelope-question {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .envelope-subtext {
        font-size: 14px;
        color: #666;
        margin-bottom: 25px;
      }

      .envelope-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .envelope-btn {
        flex: 1;
        padding: 12px 0;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: 0.3s;
      }

      .envelope-btn.yes {
        background: #28a745;
        color: white;
      }
      .envelope-btn.no {
        background: #dc3545;
        color: white;
      }
      .envelope-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }

      /* ====== Letter overlay (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß) ====== */
      .letter-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2500;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        perspective: 1200px;
      }
      .letter-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      /* ====== Envelope (‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏ï‡πà‡∏á) ====== */
      #letterEnvelope {
        position: relative;
        width: min(90vw, 360px);
        height: min(60vw, 240px);
        margin: 0 auto;
        border-radius: 14px;
        background: linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transform-style: preserve-3d;
        z-index: 14; /* ‡πÉ‡∏ï‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
      }
      /* liner / front / flap / stamp ... (‡∏Ñ‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ) */
      #letterEnvelope .env-liner {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at 20% 15%,
            rgba(255, 255, 255, 0.9),
            rgba(255, 255, 255, 0) 40%
          ),
          repeating-linear-gradient(135deg, #fdf3f6 0 12px, #f5f9ff 12px 24px);
        border-radius: 14px;
        transform: translateZ(-1px);
      }
      #letterEnvelope .env-front {
        position: absolute;
        inset: 45% 0 0 0;
        background: linear-gradient(180deg, #fff 0%, #f5f5f5 100%);
        border-bottom-left-radius: 14px;
        border-bottom-right-radius: 14px;
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.04);
      }
      #letterEnvelope .env-front::before,
      #letterEnvelope .env-front::after {
        content: "";
        position: absolute;
        bottom: 0;
        width: 58%;
        height: 72%;
        background: linear-gradient(180deg, #fff 0%, #f7f7f7 100%);
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.04);
      }
      #letterEnvelope .env-front::before {
        left: -6%;
        clip-path: polygon(0 100%, 100% 100%, 100% 0);
        border-bottom-left-radius: 14px;
      }
      #letterEnvelope .env-front::after {
        right: -6%;
        clip-path: polygon(0 100%, 100% 100%, 0 0);
        border-bottom-right-radius: 14px;
      }

      #letterEnvelope .env-flap {
        position: absolute;
        inset: 0 0 52% 0;
        background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%);
        clip-path: polygon(0 0, 100% 0, 100% 70%, 50% 100%, 0 70%);
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.05),
          0 2px 8px rgba(0, 0, 0, 0.08);
        transform-origin: 50% 0%;
        transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1),
          box-shadow 0.3s ease;
        border-top-left-radius: 14px;
        border-top-right-radius: 14px;
      }
      #letterEnvelope .env-stamp {
        position: absolute;
        right: 16px;
        top: 22%;
        translate: 0 -50%;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ff7aa8, #ff4d84);
        box-shadow: 0 4px 10px rgba(255, 77, 132, 0.35),
          inset 0 0 0 2px rgba(255, 255, 255, 0.6);
        color: #fff;
        font-weight: 700;
        line-height: 38px;
        text-align: center;
        font-size: 18px;
        user-select: none;
      }
      #letterEnvelope::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 14px;
        padding: 8px;
        -webkit-mask: linear-gradient(#000 0 0) content-box,
          linear-gradient(#000 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        background: repeating-linear-gradient(
          45deg,
          #ff5e7e 0 12px,
          #ff5e7e 12px 16px,
          #4a90ff 16px 28px,
          #4a90ff 28px 32px
        );
        pointer-events: none;
        opacity: 0.4;
      }
      #letterEnvelope.open .env-flap {
        transform: rotateX(160deg);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
      }
      #letterEnvelope:hover {
        transform: translateY(-2px);
        transition: transform 0.25s ease;
      }

      @media (max-width: 420px) {
        #letterEnvelope {
          border-radius: 12px;
        }
        #letterEnvelope .env-stamp {
          width: 34px;
          height: 34px;
          line-height: 34px;
          font-size: 16px;
        }
      }

      /* ====== Letter paper (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å @media ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏≠) ====== */
      #letterPaper.letter-paper {
        position: absolute;
        left: 50%;
        bottom: 8%;
        transform: translate(-50%, 75%); /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ã‡∏≠‡∏á */
        width: min(88vw, 340px);
        max-height: 70vh; /* ‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏ö‡∏≤‡∏¢ */
        background: #fffdf8;
        background-image: linear-gradient(
            180deg,
            rgba(0, 0, 0, 0.03),
            rgba(0, 0, 0, 0) 48px
          ),
          repeating-linear-gradient(
            180deg,
            transparent 0 44px,
            rgba(0, 0, 0, 0.045) 44px 45px
          );
        border-radius: 14px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transition: transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1),
          box-shadow 0.3s ease;
        will-change: transform;
        z-index: 15; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ã‡∏≠‡∏á */
      }
      #letterPaper .paper-notch {
        width: 52px;
        height: 6px;
        background: rgba(0, 0, 0, 0.18);
        border-radius: 999px;
        margin: 10px auto 6px;
        opacity: 0.55;
      }
      #letterPaper .paper-content {
        padding: 12px 16px 18px;
        max-height: calc(70vh - 24px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        color: #222;
        font-size: 15.5px;
        line-height: 1.6;
      }

      /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Ç‡∏∂‡πâ‡∏ô */
      #letterPaper.up {
        transform: translate(-50%, -6%); /* ‡πÇ‡∏ú‡∏•‡πà‡∏û‡πâ‡∏ô‡∏õ‡∏≤‡∏Å‡∏ã‡∏≠‡∏á */
        box-shadow: 0 18px 36px rgba(0, 0, 0, 0.24),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å */
      @media (max-width: 380px) {
        #letterPaper.letter-paper {
          width: 92vw;
        }
        #letterPaper .paper-content {
          font-size: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="gift-box" id="giftBox" style="font-size: 200px">üéÅ</div>
      <div style="color: white; font-size: 24px; margin-bottom: 20px">
        Happy Birthday! üéâ
      </div>

      <!-- Popup Birthday Message -->
      <div class="popup-overlay" id="popupOverlay">
        <div class="popup-card">
          <div class="popup-header">
            <div class="popup-avatar">
              <img src="photo/Cats Chibi GIF.gif" alt="Cats Chibi" />
            </div>
            <div class="popup-title">phognkiny üå∏</div>
            <div class="popup-subtitle">Ÿ©(‚óï‚Äø‚óï)€∂ üíê ‚ù§</div>
          </div>
          <div class="popup-body">
            <div class="popup-message" id="popupMessage">
              <div
                class="message-line"
                data-text="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠"
              ></div>
              <div class="message-line" data-text="‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ"></div>
              <div class="message-line" data-text="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á"></div>
              <div
                class="message-line"
                data-text="‡πÑ‡∏î‡πâ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á"
              ></div>
              <div
                class="message-line"
                data-text="‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ"
              ></div>
              <div
                class="message-line"
                data-text="‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï"
                style="margin-top: 15px"
              ></div>
              <div
                class="message-line"
                data-text="‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç"
              ></div>
              <div class="message-line" data-text="‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"></div>
              <div
                class="message-line"
                data-text="üéÇ‚ú® Happy Birthday! ‚ú®üéÇ"
                style="margin-top: 15px; font-size: 20px"
              ></div>
            </div>
            <button class="popup-close" onclick="showEnvelopePopup()">
              ‡πÄ‡∏õ‡∏¥‡∏î üíå
            </button>
          </div>
        </div>
      </div>

      <!-- Envelope Popup -->
      <div class="envelope-popup" id="envelopePopup">
        <div class="envelope-card">
          <div class="envelope-icon">
            <img src="./photo/No.gif" alt="cute" />
          </div>
          <div class="envelope-question">Do you want a gift? ü•∫‚ù§Ô∏è</div>
          <p class="envelope-subtext">Come on, answer üòç</p>
          <div class="envelope-buttons">
            <button
              class="envelope-btn yes"
              onclick="handleEnvelopeChoice('yes')"
            >
              Yes ‚ú®
            </button>
            <button
              class="envelope-btn no"
              onclick="handleEnvelopeChoice('no')"
            >
              No üíî
            </button>
          </div>
        </div>
      </div>

      <!-- Blessing Popup (UPDATED) -->
      <div class="envelope-popup" id="blessingPopup">
        <div class="envelope-card">
          <div class="envelope-icon">
            <img src="photo/tkthao219-bubududu.gif" alt="cute" />
          </div>
          <div class="envelope-question">
            Awh.. Let's try again? PLEASEE .‚óï‚Äø‚óï.
          </div>
          <div class="envelope-buttons">
            <button class="envelope-btn yes" onclick="tryAgain()">
              Again.. ?
            </button>
          </div>
        </div>
      </div>

      <!-- Letter Overlay -->
      <div id="letterOverlay" class="letter-overlay">
        <!-- ‡∏ã‡∏≠‡∏á -->
        <div id="letterEnvelope">
          <div class="env-liner"></div>
          <div class="env-front"></div>
          <div class="env-flap"></div>
          <div class="env-stamp">‚ô°</div>
        </div>

        <!-- ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô -->
        <div class="letter-paper" id="letterPaper" aria-label="Letter content">
          <div class="paper-notch"></div>
          <div class="paper-content">
            <p id="letterText"></p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const giftBox = document.getElementById("giftBox");
      const popupOverlay = document.getElementById("popupOverlay");
      let isClicked = false;

      const letterOverlay = document.getElementById("letterOverlay");
      const letterEnvelope = document.getElementById("letterEnvelope");
      const letterPaper = document.getElementById("letterPaper");

      function revealPaper() {
        letterPaper.classList.add("up");
        const content = letterPaper.querySelector(".paper-content");
        if (content && content.focus) content.focus();
      }

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ô openLetter() ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° .open ‡πÉ‡∏´‡πâ‡∏ã‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
      function openLetter() {
        letterOverlay.classList.add("show");
        setTimeout(() => {
          letterEnvelope.classList.add("open"); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏ã‡∏≠‡∏á
          letterEnvelope.addEventListener("click", revealPaper, { once: true }); // ‡πÅ‡∏ï‡∏∞‡∏ã‡∏≠‡∏á ‚Üí ‡∏î‡∏∂‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©

          // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏ó‡∏õ‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á #letterText (‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏î‡∏¥‡∏°)
          typeLetterMessage("...your long message...");
        }, 300);
      }

      // ‡∏õ‡∏¥‡∏î overlay ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
      function closeLetterOverlay() {
        letterOverlay.classList.remove("show");
        letterEnvelope.classList.remove("open");
        letterPaper.classList.remove("up");
      }

      // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î (‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î)
      letterOverlay.addEventListener("click", (e) => {
        if (e.target === letterOverlay) closeLetterOverlay();
      });
      // ‡∏Å‡∏±‡∏ô bubbling ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ã‡∏≠‡∏á/‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©
      letterEnvelope.addEventListener("click", (e) => e.stopPropagation());
      letterPaper.addEventListener("click", (e) => e.stopPropagation());

      giftBox.addEventListener("click", function () {
        if (!isClicked) {
          giftBox.classList.add("fade");
          document.body.classList.add("rome4-bg");
          setTimeout(() => {
            popupOverlay.classList.add("show");
            startTypewriterEffect();
          }, 1000);
          isClicked = true;
        }
      });

      function startTypewriterEffect() {
        const messageLines = document.querySelectorAll(".message-line");
        let currentLine = 0;

        function typeNextLine() {
          if (currentLine < messageLines.length) {
            const line = messageLines[currentLine];
            const text = line.getAttribute("data-text");
            line.innerHTML = "";

            const cursor = document.createElement("span");
            cursor.className = "typewriter-cursor";
            line.appendChild(cursor);

            let charIndex = 0;

            function typeChar() {
              if (charIndex < text.length) {
                line.insertBefore(
                  document.createTextNode(text[charIndex]),
                  cursor
                );
                charIndex++;
                setTimeout(typeChar, 80);
              } else {
                cursor.remove();
                currentLine++;
                setTimeout(typeNextLine, 500);
              }
            }

            typeChar();
          }
        }

        setTimeout(typeNextLine, 1000);
      }

      function showEnvelopePopup() {
        document.getElementById("envelopePopup").classList.add("show");
      }

      function handleEnvelopeChoice(choice) {
        const envelopePopup = document.getElementById("envelopePopup");
        envelopePopup.classList.remove("show");

        if (choice === "yes") {
          setTimeout(() => {
            closePopup();
            openLetter();
          }, 500);
        } else {
          setTimeout(() => {
            document.getElementById("blessingPopup").classList.add("show");
          }, 500);
        }
      }

      function closePopup() {
        popupOverlay.classList.remove("show");
      }

      function closeBlessing() {
        document.getElementById("blessingPopup").classList.remove("show");
      }

      // NEW FUNCTION: ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
      function tryAgain() {
        // ‡∏õ‡∏¥‡∏î blessing popup
        document.getElementById("blessingPopup").classList.remove("show");

        // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î envelope popup ‡πÉ‡∏´‡∏°‡πà
        setTimeout(() => {
          document.getElementById("envelopePopup").classList.add("show");
        }, 300);
      }

      function openLetter() {
        const overlay = document.getElementById("letterOverlay");
        const envelope = document.getElementById("letterEnvelope");
        overlay.classList.add("show");
        setTimeout(() => {
          envelope.classList.add("open");
          typeLetterMessage(
            "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ô‡∏∞ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å ‚ù§"
          );
        }, 300);
        overlay.addEventListener("click", () =>
          overlay.classList.remove("show")
        );
      }

      function typeLetterMessage(message) {
        const target = document.getElementById("letterText");
        target.textContent = "";
        let index = 0;
        function type() {
          if (index < message.length) {
            target.textContent += message[index];
            index++;
            setTimeout(type, 80);
          }
        }
        setTimeout(type, 900);
      }
    </script>
  </body>
</html>
